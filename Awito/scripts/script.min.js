"use strict";const dataBase=JSON.parse(localStorage.getItem("awito"))||[];let counter=dataBase.length;const btnAdd=document.querySelector(".add__ad"),modalAdd=document.querySelector(".modal__add"),modalBtnSubmit=document.querySelector(".modal__btn-submit"),modalSubmit=document.querySelector(".modal__submit"),catalog=document.querySelector(".catalog"),modalItem=document.querySelector(".modal__item"),modalBtnWarning=document.querySelector(".modal__btn-warning"),modalFileInput=document.querySelector(".modal__file-input"),modalFileBtn=document.querySelector(".modal__file-btn"),modalImageAdd=document.querySelector(".modal__image-add"),searchInput=document.querySelector(".search__input"),menuContainer=document.querySelector(".menu__container"),elementsModalSubmit=[...modalSubmit.elements].filter(t=>"BUTTON"!==t.tagName);let infoPhoto={};const saveDB=function(){localStorage.setItem("awito",JSON.stringify(dataBase))},checkForm=function(){const t=elementsModalSubmit.every(t=>t.value);modalBtnSubmit.disabled=!t,modalBtnWarning.style.display=t?"none":""},closeModal=function(t){const e=t.target;(e.classList.contains("modal__close")||e.classList.contains("modal")||e===this||"Escape"===t.key)&&(modalAdd.classList.add("hide"),modalItem.classList.add("hide"),document.removeEventListener("keydown",closeModal),modalSubmit.reset(),checkForm(),modalImageAdd.src="img/temp.jpg",modalFileBtn.textContent="Добавить фото")},renderCard=function(t=dataBase){catalog.textContent="",t.forEach(t=>{catalog.insertAdjacentHTML("beforeend",`\n    <li class="card" data-id="${t.id}">\n\t\t\t\t\t<img class="card__image" src=" data:image/jpeg;base64,${t.image}" alt="test">\n\t\t\t\t\t<div class="card__description">\n\t\t\t\t\t\t<h3 class="card__header">${t.nameItem}</h3>\n\t\t\t\t\t\t<div class="card__price">${t.costItem} ₽</div>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n    `)})};searchInput.addEventListener("input",()=>{const t=searchInput.value.trim().toLowerCase();if(t.length>2){const e=dataBase.filter(e=>e.nameItem.toLowerCase().includes(t)||e.descriptionItem.toLowerCase().includes(t));renderCard(e)}else renderCard()}),modalFileInput.addEventListener("change",function(t){const e=t.target,a=new FileReader,n=e.files[0];infoPhoto.filename=n.name,infoPhoto.size=n.size,a.readAsBinaryString(n),a.addEventListener("load",t=>{infoPhoto.size<2e5?(modalFileBtn.textContent=infoPhoto.filename,infoPhoto.base64=btoa(t.target.result),modalImageAdd.src=`data:image/jpeg;base64,${infoPhoto.base64}`):(modalFileBtn.textContent="Размер файла не должен превышать 200Кб",modalFileInput.value="",checkForm())})}),modalSubmit.addEventListener("input",checkForm),modalSubmit.addEventListener("submit",t=>{t.preventDefault();const e={};for(const t of elementsModalSubmit)e[t.name]=t.value;e.id=counter++,e.image=infoPhoto.base64,dataBase.push(e),saveDB(),closeModal({target:modalAdd}),renderCard()}),btnAdd.addEventListener("click",function(){modalAdd.classList.remove("hide"),modalBtnSubmit.disabled=!0,document.addEventListener("keydown",closeModal)}),catalog.addEventListener("click",function(t){const e=t.target;if(e.closest(".card")){const t=e.closest(".card"),a=dataBase.find(e=>e.id===+t.dataset.id);modalItem.innerHTML=`\n    <div class="modal__block">\n\t\t\t<h2 class="modal__header">Купить</h2>\n\t\t\t<div class="modal__content">\n\t\t\t\t<div><img class="modal__image modal__image-item" src="data:image/jpeg;base64,${a.image}" alt="test"></div>\n\t\t\t\t<div class="modal__description">\n\t\t\t\t\t<h3 class="modal__header-item">${a.nameItem}</h3>\n\t\t\t\t\t<p>Состояние: <span class="modal__status-item">${"new"===a.status?"Новый":"Б/У"}</span></p>\n\t\t\t\t\t<p>Описание:\n\t\t\t\t\t\t<span class="modal__description-item">${a.descriptionItem}</span>\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>Цена: <span class="modal__cost-item">${a.costItem} ₽</span></p>\n\t\t\t\t\t<button class="btn">Купить</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button class="modal__close">&#10008;</button>\n\t\t</div>\n    `,modalItem.classList.remove("hide"),document.addEventListener("keydown",closeModal)}}),menuContainer.addEventListener("click",function(t){const e=t.target;if("A"===e.tagName){const t=dataBase.filter(t=>t.category===e.dataset.category);renderCard(t)}}),modalAdd.addEventListener("click",closeModal),modalItem.addEventListener("click",closeModal),renderCard();